{"version":3,"file":"Step1-CqWEAUiU.js","sources":["../../../resources/js/Pages/Offers/components/create/steps/Step1.tsx"],"sourcesContent":["import { LabelInputContainer } from \"@/components/ui/LabelInputContainer\";\r\nimport React, { useEffect, useState, useCallback } from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Head } from \"@inertiajs/react\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { step1Schema } from \"./schemas\";\r\nimport InputError from \"@/components/InputError\";\r\nimport ImageUploader from \"@/components/ui/image-uploader\";\r\n\r\ninterface StepProps {\r\n    showMeta: boolean;\r\n    formData: any;\r\n    errors: any;\r\n    setFormData: (data: any) => void;\r\n    setShowMeta: any;\r\n    currentStep: number;\r\n    setCurrentStep: any;\r\n}\r\n\r\nconst debounce = (func: (...args: any[]) => void, delay: number) => {\r\n    let timer: NodeJS.Timeout;\r\n    return (...args: any[]) => {\r\n        clearTimeout(timer);\r\n        timer = setTimeout(() => {\r\n            func(...args);\r\n        }, delay);\r\n    };\r\n};\r\n\r\nconst Step1: React.FC<StepProps> = ({\r\n    formData,\r\n    setFormData,\r\n    errors,\r\n    showMeta,\r\n    setShowMeta,\r\n    currentStep,\r\n    setCurrentStep,\r\n}) => {\r\n    const [urlError, setUrlError] = useState<string | null>(null);\r\n    const [fetching, setFetching] = useState(false);\r\n    const [validationErrors, setValidationErrors] = useState<any>({});\r\n\r\n    const fetchMetadata = useCallback(\r\n        async (url: string) => {\r\n            setFetching(true);\r\n            setShowMeta(false);\r\n            try {\r\n                const res = await fetch(\r\n                    `/fetch-metadata?url=${encodeURIComponent(url)}`,\r\n                );\r\n                if (!res.ok) {\r\n                    throw new Error(\"Failed to fetch metadata\");\r\n                }\r\n                const metaData = await res.json();\r\n                setFormData({\r\n                    ...formData,\r\n                    main_url: url,\r\n                    title: metaData.title,\r\n                    description: metaData.description,\r\n                    keywords: metaData.keywords,\r\n                    image: metaData.image,\r\n                });\r\n                setShowMeta(true);\r\n                setFetching(false);\r\n            } catch (error) {\r\n                toast.error(\r\n                    \"Failed to fetch metadata for this URL! Please enter manually or check the URL.\",\r\n                );\r\n                setFetching(false);\r\n                setShowMeta(true);\r\n            }\r\n        },\r\n        [setFormData, setShowMeta, formData],\r\n    );\r\n\r\n    const debouncedFetchMetadata = useCallback(debounce(fetchMetadata, 500), [\r\n        fetchMetadata,\r\n    ]);\r\n\r\n    const handleUrlChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const url = e.target.value;\r\n        if (url !== formData.main_url) {\r\n            setFormData({ ...formData, main_url: url });\r\n\r\n            // Validate the URL using Zod\r\n            const validation = step1Schema.shape.main_url.safeParse(url);\r\n            if (!validation.success) {\r\n                setUrlError(validation.error.errors[0].message);\r\n                setShowMeta(false);\r\n            } else {\r\n                setUrlError(null);\r\n                debouncedFetchMetadata(url);\r\n            }\r\n        }\r\n    };\r\n\r\n    const validateForm = () => {\r\n        // Perform full validation\r\n        const validation = step1Schema.safeParse(formData);\r\n        if (!validation.success) {\r\n            const formattedErrors = validation.error.format();\r\n            setValidationErrors({\r\n                main_url: formattedErrors.main_url?._errors[0] || null,\r\n                title: formattedErrors.title?._errors[0] || null,\r\n                description: formattedErrors.description?._errors[0] || null,\r\n            });\r\n            return false;\r\n        }\r\n        setValidationErrors({});\r\n        return true;\r\n    };\r\n\r\n    const handleNextClick = () => {\r\n        // Validate form data before proceeding to the next step\r\n        if (validateForm()) {\r\n            setCurrentStep(currentStep + 1);\r\n        } else {\r\n            toast.error(\"Please fix the validation errors.\");\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Trigger metadata fetch only if the URL is valid and debounced\r\n        if (formData.main_url && !urlError && !showMeta) {\r\n            debouncedFetchMetadata(formData.main_url);\r\n        }\r\n    }, [formData.main_url, urlError, showMeta, debouncedFetchMetadata]);\r\n\r\n    return (\r\n        <div>\r\n            <Head title=\"Basic Information\" />\r\n            <div className=\"bg-white dark:bg-slate-900 p-2 rounded\">\r\n                <LabelInputContainer\r\n                    label=\"Offer URL\"\r\n                    helperText=\"www.offer1.com?o=1&p=2\"\r\n                    type=\"url\"\r\n                    onChange={handleUrlChange}\r\n                    value={formData.main_url}\r\n                    errorMessage={urlError || validationErrors.main_url || \"\"}\r\n                    bottomMessage=\"Paste offer url to help us to fetch metadata of offer.\"\r\n                />\r\n            </div>\r\n            <AnimatePresence>\r\n                {showMeta && (\r\n                    <motion.div\r\n                        className=\"mt-4 space-y-2\"\r\n                        initial={{ opacity: 0, y: 50 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: 50 }}\r\n                        transition={{ duration: 0.5 }}\r\n                    >\r\n                        <h3 className=\"font-semibold\">Metadata Details:</h3>\r\n                        <div className=\"bg-white dark:bg-slate-900 p-2 rounded\">\r\n                            <LabelInputContainer\r\n                                label=\"Title\"\r\n                                helperText=\"eg: Offer 1 - An awesome offer\"\r\n                                type=\"text\"\r\n                                value={formData.title}\r\n                                errorMessage={\r\n                                    validationErrors.title || errors.title || \"\"\r\n                                }\r\n                                onChange={(e) =>\r\n                                    setFormData({\r\n                                        ...formData,\r\n                                        title: e.target.value,\r\n                                    })\r\n                                }\r\n                            />\r\n                        </div>\r\n                        <div className=\"bg-white dark:bg-slate-900 p-2 rounded\">\r\n                            <Label>Description</Label>\r\n                            <Textarea\r\n                                value={formData.description}\r\n                                placeholder=\"Something about offer....\"\r\n                                onChange={(e) =>\r\n                                    setFormData({\r\n                                        ...formData,\r\n                                        description: e.target.value,\r\n                                    })\r\n                                }\r\n                            />\r\n                            <InputError\r\n                                message={\r\n                                    errors.description ||\r\n                                    validationErrors.description\r\n                                }\r\n                            />\r\n                        </div>\r\n                        <div className=\"bg-white dark:bg-slate-900 p-2 rounded flex justify-between items-center\">\r\n                            <div className=\"\">\r\n                                <Label>Upload or Change Image</Label>\r\n                                <p className=\"text-sm\">\r\n                                    Upload a new image for this offer meta!\r\n                                </p>\r\n                            </div>\r\n                            <ImageUploader\r\n                                selected_image={formData.image}\r\n                                onUpload={(path: string) =>\r\n                                    setFormData({ ...formData, image: path })\r\n                                }\r\n                            />\r\n                        </div>\r\n                        <div className=\"bg-white dark:bg-slate-900 p-2 rounded\">\r\n                            <Label>Image</Label>\r\n                            <img\r\n                                src={formData.image}\r\n                                alt={formData.image}\r\n                                className=\"w-full h-[400px]\"\r\n                            />\r\n                            <InputError message={errors.image} />\r\n                        </div>\r\n\r\n                        <div className=\"flex w-full justify-end items-center mt-4\">\r\n                            <Button onClick={handleNextClick} className=\"mr-2\">\r\n                                Next\r\n                            </Button>\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n            {fetching && (\r\n                <div className=\"w-full space-y-2 mt-4\">\r\n                    <Skeleton className=\"w-full h-12\" />\r\n                    <Skeleton className=\"w-full h-20\" />\r\n                    <Skeleton className=\"w-full h-48\" />\r\n                    <Skeleton className=\"w-full h-20\" />\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Step1;\r\n"],"names":["debounce","func","delay","timer","args","Step1","formData","setFormData","errors","showMeta","setShowMeta","currentStep","setCurrentStep","urlError","setUrlError","useState","fetching","setFetching","validationErrors","setValidationErrors","fetchMetadata","useCallback","url","res","metaData","toast","debouncedFetchMetadata","handleUrlChange","e","validation","step1Schema","validateForm","formattedErrors","_a","_b","_c","handleNextClick","useEffect","jsx","Head","LabelInputContainer","AnimatePresence","jsxs","motion","Label","Textarea","InputError","ImageUploader","path","Button","Skeleton"],"mappings":"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"}